% !TEX root =  ICRA2012-Patil.tex

Motion planning for robots is often complicated by real-world uncertainties; the motion of the robot may deviate unpredictably from the assumed dynamics model, and sensors might yield noisy and partial state measurements of the robot state. For many applications, 
%ranging from self-driving cars \cite{Thrun10_CACM} to steerable medical needles operating in the human body \cite{Cowan2011_Chapter}
the motion plan chosen for execution should be as safe as possible so that the robot does not collide with obstacles in the environment. In this work, we present a fast, analytical method to estimate the probability of collision for a robot executing a motion plan under Gaussian models of motion and sensing uncertainty.

Estimating the probability of collision is an integral step in several motion planning under uncertainty algorithms for characterizing the safety of motion plans. A na\"{i}ve Monte-Carlo sampling strategy could be used to accurately estimate the probability of collision by computing the ratio of the number of Monte-Carlo simulations that are collision free. This approach is general enough to consider all sources of uncertainty, including motion and sensing uncertainty, and uncertainty in sensing the obstacles in the environment. However, this estimation process can be computationally expensive if performed repeatedly during the planning process.

\begin{figure}[t]
\centering
\includegraphics[width=240pt,clip]{figures/truncatedGaussians3.pdf}
\vspace{-5pt}
\caption{We estimate the probability of collision based on a priori probability distributions of the robot state. The probabilities of collision at each stage of the plan are conditioned on the previous stages being collision free. We truncate the a priori distributions with respect to obstacles to discount plan executions that collide with obstacles (black disks). Propagating the truncated distributions (black ellipses) accounts for only the collision free samples (red disks), resulting in accurate estimation of the probability of collision. Using the unconditional distributions (gray ellipses) to estimate the collision probability results in a very conservative estimate.}
\label{fig:teaser}
\vspace*{-10pt}
\end{figure}

To avoid running multiple Monte-Carlo simulations, we instead estimate the probability of collision based on a priori probability distributions of the robot state, under Gaussian assumptions of motion and sensing uncertainty. Prior methods have explored this avenue \cite{vandenBerg11_IJRR, Bry11_ICRA, Vitus11_ICRA}, but they typically ``approximate'' the collision probability of a plan by assuming the probabilities of collision at stages along the plan are independent. Formally speaking, let $\mathbf{x}_t \in \mathcal{X}$ denote the state of the robot at stage $t$ along the plan, and $\mathcal{X}_{F} \subset \mathcal{X}$ denote the feasible space not occupied by obstacles. Prior methods assume that the probability that a plan consisting of $\ell$ stages is collision free is given by $p(\bigwedge_{t = 0}^{\ell} \; \mathbf{x}_t \in \mathcal{X}_{F}) \approx \prod_{t = 0}^\ell p(\mathbf{x}_{t} \in \mathcal{X}_{F})$. This yields an overly conservative estimate of the probability of collision (see Fig.\ \ref{fig:teaser}), which might result in overly conservative motion plans and, depending on the safety required by the motion planner, may result in failure to find a feasible plan even if one exists.

In contrast, we account for the fact that the distribution of the state at each stage along the plan is \emph{conditioned} on the previous stages being collision free i.e., the probability that a plan is collision free is given by $p(\bigwedge_{t = 0}^{\ell}\; \mathbf{x}_t \in \mathcal{X}_{F}) = \prod_{t = 0}^\ell p(\mathbf{x}_{t} \in \mathcal{X}_{F}\; |\; \bigwedge_{i = 0}^{t-1} \; \mathbf{x}_i \in \mathcal{X}_{F})$. This amounts to propagating the a priori distributions forward in time in such a way that instances that collide with obstacles are discounted from the propagation (Fig. \ref{fig:teaser}). For this we propose a novel method to truncate the a priori distributions with respect to obstacles, approximate the truncated distributions by Gaussians, and propagate them forward in time. This results in an accurate estimate of the conditional distributions, and consequently, enables accurate estimation of the collision probability.

%Even though the exposition outlines a method to truncate the distributions with respect to obstacles, we can directly apply this methodology to estimate the a a priori distributions with other constraints on the state variables (such as imposing limits on velocity, acceleration etc. of the robot).
Our method can either be directly used to quantify the safety of a plan \cite{vandenBerg11_IJRR, Patil11_RSS}, to improve quality of estimation of collision chance constraints \cite{Bry11_ICRA, Vitus11_ICRA}, or to elegantly account for hard state constraints imposed by obstacles in optimization based \cite{Erez10_UAI} or inference based \cite{Toussaint09_ICML} planning methods. Our truncation approach is also directly applicable to the important problem of optimal state estimation with hard state constraints \cite{Book:Simon06}.

We present simulation results for a car-like robot with second-order dynamics, and a nonholonomic bevel-tip flexible needle, navigating with stochastic dynamics while operating under the guidance of partial and noisy state measurements. Our results suggest that our method is orders of magnitude faster than na\"{i}ve sampling based methods, and the mean error in estimating the probability of collision is considerably lesser as compared to prior methods.